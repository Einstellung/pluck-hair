# Development Configuration
# =========================
# Override settings for local development
# No external dependencies (MinIO, PostgreSQL) required

app:
  log_level: "DEBUG"

# Use mock camera for development without hardware
camera:
  # type: mock
  # mode: directory  # random or directory
  # width: 640
  # height: 480
  # image_dir: ./assets 
  type: daheng
  device_index: 1
  exposure_time: 9000  # Exposure time in microseconds
  white_balance_mode: once

# Use local storage instead of MinIO
storage:
  images:
    type: local
    path: ./data/images
  
  # Use SQLite instead of PostgreSQL
  database:
    type: sqlite
    path: ./data/pluck_dev.db
    echo: false

# Tile-based detection pipeline
vision:
  pipeline:
    steps:
      - name: tile
        type: tile
        params:
          tile_size: 640
          overlap: 0.2
      - name: detect
        type: yolo
        params:
          model: assets/best.pt
          conf: 0.25  # Lower threshold for testing
          device: auto  # Use GPU if available
      - name: merge
        type: merge_tiles
        params:
          iou_threshold: 0.5

scheduler:
  loop_delay_ms: 10  # Slower for debugging
  save_images: false
  save_annotated: false
  show_preview: true  # Show real-time OpenCV preview window

# Task configuration (detection + optional tracking)
task:
  name: "detection"
  tracker:
    enabled: false             # Disable ByteTrack for static scene; use smoothing instead
    track_thresh: 0.5          # High confidence threshold for tracking
    track_buffer: 30           # Frames to keep lost tracks
    match_thresh: 0.8          # IoU threshold for matching
    min_hits: 3                # Consecutive hits before track is confirmed
    frame_rate: 30             # Expected frame rate
  smoothing:
    enabled: true
    alpha: 0.12                # 0.1-0.2 gives a ~5-10 frame low-pass effect
    min_iou: 0.2               # Match to previous box for blending
    max_center_jump: 40.0      # Pixels; reset smoothing if jump exceeds this
  done_condition:
    consecutive_empty: 3     # Stop after N consecutive empty frames
    max_iterations: 1000     # Stop after N iterations
    timeout_seconds: 60      # Stop after timeout

# Video stream (MJPEG)
video_stream:
  enabled: true
  stream: "pluck:frames"
  maxlen: 20
  fps_limit: 10.0
  jpeg_quality: 70
  block_ms: 2000

# Redis (optional in development; set enabled=true when running Redis locally)
redis:
  url: "redis://localhost:6379/0"
  stream: "pluck:detections"
  consumer_group: "api"
  consumer_name: "dev-api"
  maxlen: 2000
  read_count: 10
  block_ms: 5000
  enabled: true
